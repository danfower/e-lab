<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>e-Lab Inventory Management</title>
</head>
<body>
    <header>
        <img src="header-elab.png" alt="Header Image">
        <h1>e-Lab Inventory Management</h1>
    </header>
    <main>
        <div id="menu">
            <button id="stock-dashboard-btn">Stock Dashboard</button>
            <button id="add-stock-btn">Add Stock</button>
            <button id="use-stock-btn">Use Stock</button>
            <button id="low-stock-btn">Low Stock Items</button>
        </div>
        <div id="content">
            <!-- Dynamic content will be loaded here -->
            <p>Welcome to the e-Lab Inventory Management System. Use the menu to navigate.</p>
        </div>
    </main>
    <script>
        // Initialize the API base URL
        const API_BASE_URL = "https://e-lab.onrender.com"; // Replace with your backend URL

        // Get references to buttons and content area
        const content = document.getElementById("content");
        const stockDashboardBtn = document.getElementById("stock-dashboard-btn");
        const addStockBtn = document.getElementById("add-stock-btn");
        const useStockBtn = document.getElementById("use-stock-btn");
        const lowStockBtn = document.getElementById("low-stock-btn");

        // Show Add Stock Form
        function showAddStockForm() {
            content.innerHTML = `
                <h2>Add Stock</h2>
                <form id="add-stock-form">
                    <label for="name">Stock Name:</label>
                    <input type="text" id="name" required>
                    <label for="category">Category:</label>
                    <input type="text" id="category">
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" required>
                    <label for="min-threshold">Minimum Threshold:</label>
                    <input type="number" id="min-threshold" required>
                    <button type="submit">Add Stock</button>
                </form>
            `;

            document.getElementById("add-stock-form").onsubmit = (e) => {
                e.preventDefault();
                const name = document.getElementById("name").value;
                const category = document.getElementById("category").value;
                const quantity = parseInt(document.getElementById("quantity").value, 10);
                const minThreshold = parseInt(document.getElementById("min-threshold").value, 10);

                addStock({ name, category, quantity, min_threshold: minThreshold });
            };
        }

        // Add Stock API Call
        function addStock(stock) {
            fetch(`${API_BASE_URL}/add_stock`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(stock),
            })
                .then((response) => response.json())
                .then((data) => alert(data.message))
                .catch((error) => console.error("Error:", error));
        }

        // Load Stock Dashboard
        function loadStockDashboard() {
            fetch(`${API_BASE_URL}/get_stock`)
                .then((response) => response.json())
                .then((data) => {
                    content.innerHTML = "<h2>Stock Dashboard</h2>";
                    if (data.length === 0) {
                        content.innerHTML += "<p>No stock items available.</p>";
                        return;
                    }

                    data.forEach((item) => {
                        content.innerHTML += `
                            <div class="stock-item">
                                <p><strong>${item.name}</strong></p>
                                <p>Category: ${item.category || "N/A"}</p>
                                <p>Quantity: ${item.quantity}</p>
                                <p>Min Threshold: ${item.min_threshold}</p>
                                <button onclick="useStock(${item.id})">Use Stock</button>
                                <button onclick="deleteStock(${item.id})">Delete</button>
                            </div>
                        `;
                    });
                })
                .catch((error) => console.error("Error:", error));
        }

        // Use Stock Functionality
        function showUseStockForm() {
            fetch(`${API_BASE_URL}/get_stock`)
                .then((response) => response.json())
                .then((data) => {
                    if (data.length === 0) {
                        content.innerHTML = "<h2>Use Stock</h2><p>No stock items available to use.</p>";
                        return;
                    }

                    content.innerHTML = `
                        <h2>Use Stock</h2>
                        <form id="use-stock-form">
                            <label for="stock-select">Select Stock Item:</label>
                            <select id="stock-select" required>
                                ${data
                                    .map(
                                        (item) =>
                                            `<option value="${item.id}">${item.name} (Available: ${item.quantity})</option>`
                                    )
                                    .join("")}
                            </select>
                            <label for="quantity">Quantity to Use:</label>
                            <input type="number" id="quantity" required>
                            <button type="submit">Use Stock</button>
                        </form>
                    `;

                    document.getElementById("use-stock-form").onsubmit = (e) => {
                        e.preventDefault();
                        const stockId = document.getElementById("stock-select").value;
                        const quantity = parseInt(document.getElementById("quantity").value, 10);

                        useStock(stockId, quantity);
                    };
                })
                .catch((error) => console.error("Error:", error));
        }

        function useStock(stockId, quantity) {
            if (quantity > 0) {
                fetch(`${API_BASE_URL}/use_stock/${stockId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ quantity }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        alert(data.message);
                        loadStockDashboard();
                    })
                    .catch((error) => console.error("Error:", error));
            } else {
                alert("Please enter a valid quantity.");
            }
        }

        // Delete Stock API Call
        function deleteStock(stockId) {
            if (confirm("Are you sure you want to delete this stock item?")) {
                fetch(`${API_BASE_URL}/remove_stock/${stockId}`, {
                    method: "DELETE",
                })
                    .then((response) => response.json())
                    .then((data) => {
                        alert(data.message);
                        loadStockDashboard();
                    })
                    .catch((error) => console.error("Error:", error));
            }
        }

        // Load Low Stock Items
        function loadLowStock() {
            fetch(`${API_BASE_URL}/check_low_stock`)
                .then((response) => response.json())
                .then((data) => {
                    content.innerHTML = "<h2>Low Stock Items</h2>";
                    if (data.length === 0) {
                        content.innerHTML += "<p>All stock items are above their thresholds.</p>";
                        return;
                    }

                    data.forEach((item) => {
                        content.innerHTML += `
                            <div class="stock-item">
                                <p><strong>${item.name}</strong></p>
                                <p>Quantity: ${item.quantity}</p>
                                <p>Min Threshold: ${item.min_threshold}</p>
                            </div>
                        `;
                    });
                })
                .catch((error) => console.error("Error:", error));
        }

        // Add Event Listeners
        stockDashboardBtn.addEventListener("click", loadStockDashboard);
        addStockBtn.addEventListener("click", showAddStockForm);
        useStockBtn.addEventListener("click", showUseStockForm);
        lowStockBtn.addEventListener("click", loadLowStock);
    </script>
</body>
</html>
